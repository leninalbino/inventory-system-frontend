<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<p-toolbar styleClass="mb-3">
  <div class="p-toolbar-group-left">
    <button *ngIf="isAdmin" type="button" class="toolbar-btn create-btn" (click)="openNew()">
      <i class="pi pi-plus"></i>
      <span>Nuevo</span>
    </button>
  </div>
  <div class="p-toolbar-group-right" style="display:flex; gap:.5rem;">
    <span class="p-input-icon-left">
      <i class="pi pi-search"></i>
      <input pInputText type="text" placeholder="Buscar por nombre" [(ngModel)]="filterName"/>
    </span>
    <input pInputText type="text" placeholder="Filtrar categoría" [(ngModel)]="filterCategory"/>
    <button type="button" class="toolbar-btn report-btn" (click)="downloadLowStockPdf()">
      <i class="pi pi-download"></i>
      <span>Reporte PDF</span>
    </button>
  </div>
</p-toolbar>

<p-table [value]="filteredProducts" [loading]="loading" [paginator]="true" [rows]="10">
  <ng-template pTemplate="header">
    <tr>
      <th>Nombre</th>
      <th>Descripción</th>
      <th>Precio</th>
      <th>Cantidad</th>
      <th>Categoría</th>
      <th *ngIf="isAdmin">Acciones</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-p>
    <tr [ngClass]="{'low-stock-row': p.quantity < 5}">
      <td>{{p.name}}</td>
      <td>{{p.description}}</td>
      <td>{{p.price | currency:'USD':'symbol'}}</td>
      <td>
        <p-tag [value]="p.quantity" [severity]="p.quantity < 5 ? 'danger' : 'success'"></p-tag>
      </td>
      <td>{{p.category}}</td>
      <td *ngIf="isAdmin">
        <div class="action-buttons">
          <button type="button" class="action-btn edit-btn" (click)="edit(p)" pTooltip="Editar producto">
            <i class="pi pi-pencil"></i>
            <span class="btn-text">Editar</span>
          </button>
          <button type="button" class="action-btn delete-btn" (click)="remove(p)" pTooltip="Eliminar producto">
            <i class="pi pi-trash"></i>
            <span class="btn-text">Eliminar</span>
          </button>
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog [(visible)]="dialog" [modal]="true" [style]="{width:'500px'}" [draggable]="false" [resizable]="false">
  <ng-template pTemplate="header">
    {{ editing ? 'Editar Producto' : 'Nuevo Producto' }}
  </ng-template>

  <form class="form" (ngSubmit)="save()" [formGroup]="form">
    <div class="field" *ngIf="editing">
      <label>ID</label>
      <input pInputText formControlName="id" readonly />
    </div>
    <div class="field">
      <label>Nombre</label>
      <input pInputText formControlName="name" />
    </div>
    <div class="field">
      <label>Descripción</label>
      <input pInputText formControlName="description" />
    </div>
    <div class="field">
      <label>Precio</label>
      <p-inputNumber formControlName="price" mode="currency" currency="USD" locale="en-US"></p-inputNumber>
    </div>
    <div class="field">
      <label>Cantidad</label>
      <p-inputNumber formControlName="quantity" [min]="0"></p-inputNumber>
    </div>
    <div class="field">
      <label>Categoría</label>
      <p-dropdown [options]="categories" formControlName="category" optionLabel="label" optionValue="value"></p-dropdown>
    </div>

    <div class="form-actions">
      <button type="button" class="form-btn cancel-btn" (click)="dialog=false">
        <i class="pi pi-times"></i>
        <span>Cancelar</span>
      </button>
      <button type="submit" class="form-btn submit-btn" [disabled]="form.invalid">
        <i class="pi pi-check"></i>
        <span>{{ editing ? 'Actualizar' : 'Guardar' }}</span>
      </button>
    </div>
  </form>
</p-dialog>
